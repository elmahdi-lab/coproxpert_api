trigger:
  - main

resources:
  - repo: self

variables:
  artifactName: 'coproxpert-api'

stages:
  - stage: Build
    displayName: Build and Publish Artifact
    jobs:
      - job: Build
        displayName: Build and Publish
        pool:
          vmImage: ubuntu-latest
        steps:
          - script: |
              go build -o /srv/main $(Build.SourcesDirectory)/main.go
            displayName: 'Compile Project'

          - task: ArchiveFiles@2
            displayName: 'Archive Files'
            inputs:
              rootFolderOrFile: '/srv/main'
              includeRootFolder: false
              archiveType: 'tar'
              tarCompression: 'bz2'
              archiveFile: '/srv/$(artifactName)-$(Build.BuildNumber).tar.bz2'
              replaceExistingArchive: true

          - task: PublishPipelineArtifact@1
            displayName: 'Publish Artifact'
            inputs:
              targetPath: '/srv'
              artifact: '$(artifactName)-$(Build.BuildNumber).tar.bz2'
