trigger:
  - main

resources:
  - repo: self

variables:
  artifactName: 'coproxpert-api'

stages:
  - stage: Build
    displayName: Build and Publish Artifact
    jobs:
      - job: Build
        displayName: Build and Publish
        pool:
          vmImage: ubuntu-latest
        steps:
          - script: |
              go build -o $(Build.ArtifactStagingDirectory)/main-$(Build.BuildNumber) $(Build.SourcesDirectory)/main.go
            displayName: 'Compile Project'

          - task: ArchiveFiles@2
            displayName: 'Archive Files'
            inputs:
              rootFolderOrFile: '$(Build.ArtifactStagingDirectory)'
              includeRootFolder: false
              archiveType: 'zip'
              archiveFile: '$(Build.ArtifactStagingDirectory)/$(artifactName)-$(Build.BuildNumber).zip'
              replaceExistingArchive: true

          - task: PublishPipelineArtifact@1
            displayName: 'Publish Artifact'
            inputs:
              targetPath: '$(Build.ArtifactStagingDirectory)'
              artifact: '$(artifactName)-$(Build.BuildNumber).zip'
