trigger:
  - main

resources:
  - repo: self

variables:
  artifactName: 'coproxpert-api'

stages:
  - stage: Build
    displayName: Build and Publish Artifact
    jobs:
      - job: Build
        displayName: Build and Publish
        pool:
          vmImage: ubuntu-latest
        steps:
          - script: |
              go build -o $(Build.BinariesDirectory)/main $(Build.SourcesDirectory)/main.go
            displayName: Compile go project
          - task: ArchiveFiles@2
            inputs:
              rootFolderOrFile: '$(Build.BinariesDirectory)/main'
              includeRootFolder: true
              archiveType: 'tar'
              tarCompression: 'bz2'
              archiveFile: '$(Build.ArtifactStagingDirectory)/$(artifactName)-$(Build.BuildNumber).tar.bz2'
              replaceExistingArchive: true
            displayName: 'Archive Project'
          
          - task: PublishPipelineArtifact@1
            displayName: 'Publish Artifact'
            inputs:
              targetPath: '$(Build.ArtifactStagingDirectory)/$(artifactName)-$(Build.BuildNumber).tar.bz2'
              artifact: '$(artifactName)-$(Build.BuildNumber)'
              publishLocation: 'pipeline'
